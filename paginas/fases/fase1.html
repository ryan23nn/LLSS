<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cap√≠tulo 1</title>
  <link rel="stylesheet" href="../../css/geral.css">
  <link rel="icon" href="img/icon.png" type="image/x-icon">
  <style>
    .input-section {
      margin-top: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      border: 2px solid #fff;
      padding: 20px;
      border-radius: 10px;
      background-color: transparent;
      color: #fff;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
    .input-section label {
      font-size: 1.1em;
    }
    .input-section input {
      padding: 10px;
      width: 100%;
      border-radius: 6px;
      border: 1.5px solid #fff;
      background-color: transparent;
      color: #fff;
      text-align: center;
    }
    .input-section input::placeholder {
      color: #aaa;
      text-align: center;
    }
    .input-section button {
      background-color: transparent;
      color: #fff;
      border: 1.5px solid #fff;
      padding: 10px 25px;
      font-size: 1.1em;
      cursor: pointer;
      border-radius: 6px;
      font-weight: 600;
    }
    .input-section button:hover {
      background-color: #444;
    }
    .genero-buttons button {
      margin: 0 5px;
    }
    .genero-selecionado {
      border: 3px solid #fff !important;
      background-color: #333 !important;
    }
    #opcoesHistoria button {
      margin: 10px;
      padding: 10px 20px;
      background-color: transparent;
      border: 1.5px solid #fff;
      color: #fff;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    #opcoesHistoria button:hover {
      background-color: #444;
    }
  </style>
</head>
<body>
  <nav>
    <p id="filhos-contador">Filhos: 0</p>
    <p id="dinheiro-contador">Dinheiro: R$ 0</p>
  </nav>
  <section class="jogo">
    <h1 id="tituloFase"></h1>
    <div id="gameContainer">
      <p id="resposta" class="storyText"></p>
      <div id="inputArea" class="input-section" style="display:none;">
        <label for="nomeBebe">Escolha o nome do beb√™:</label>
        <input type="text" id="nomeBebe" placeholder="Digite o nome">
        <div class="genero-buttons">
          <button id="btnMenino" onclick="selecionarGenero('masculino')">Menino</button>
          <button id="btnMenina" onclick="selecionarGenero('feminino')">Menina</button>
        </div>
        <button onclick="confirmarNome()">Confirmar</button>
      </div>
      <div id="continuaTexto" class="storyText" style="display:none;"></div>
      <div id="opcoesHistoria" style="display:none;"></div>
    </div>
  </section>
  <script>
    const escolha = localStorage.getItem('escolhaFinal');
    const escolhaFinal1 = localStorage.getItem('escolhaFinal1');
    const nomeBebe = localStorage.getItem('nomeBebe');
    const generoBebe = localStorage.getItem('generoBebe');
    const resposta = document.getElementById("resposta");
    const tituloFase = document.getElementById("tituloFase");
    const inputArea = document.getElementById("inputArea");
    const continuaTexto = document.getElementById("continuaTexto");
    const opcoesHistoria = document.getElementById("opcoesHistoria");
    let generoSelecionado = "";

    function typeWriter(text, element, i = 0, speed = 30, callback) {
      if (i < text.length) {
        element.innerHTML += text.charAt(i) === '\n' ? '<br>' : text.charAt(i);
        const delay = (text.charAt(i) === '.' && i < text.length - 1) ? 600 : speed;
        setTimeout(() => typeWriter(text, element, i + 1, speed, callback), delay);
      } else {
        if (callback) callback();
      }
    }

    function iniciarDigitacao() {
      if (escolhaFinal1 === "samara_emprego" || escolhaFinal1 === "samuel_emprego") {
        mostrarHistoriaCompleta(escolhaFinal1);
        return;
      }

      if (escolha === "engravidar") {
        tituloFase.textContent = "Eis a√≠ o descendente üë∂üèΩ";
        const texto = `Samara chegou com os olhos cheios d‚Äô√°gua, segurando o pequeno teste nas m√£os tr√™mulas.
        
‚Äî Samuel, estou gr√°vida.

Ele n√£o respondeu de imediato. Apenas a observou por longos segundos, como se ela tivesse acabado de abrir uma janela nova no mundo. Por fim, respirou fundo e assentiu, como quem aceita o improv√°vel com ternura.

Os meses seguintes foram um turbilh√£o calado ‚Äî entre consultas, sonhos sussurrados e receios n√£o ditos. Quando a crian√ßa finalmente chegou, numa madrugada √∫mida de abril, os dois n√£o choraram. Apenas se olharam. E riram.`;

        typeWriter(texto, resposta, 0, 30, () => {
          if (nomeBebe && generoBebe) {
            inputArea.style.display = "none";
            mostrarContinuidadeNomeSalvo(nomeBebe, generoBebe);
          } else {
            inputArea.style.display = "flex";
          }
        });
      } else if (escolha === "casar") {
        tituloFase.textContent = "A nova vida a dois";
        const texto = `‚Äî Voc√™ acha que a gente d√° certo? ‚Äî perguntou Samara, encarando a chuva escorrendo pela janela do cart√≥rio.

‚Äî Eu acho que a gente insiste ‚Äî respondeu Samuel, com o olhar perdido na alian√ßa rec√©m-colocada.

N√£o foi um casamento de filme. Mas foi deles. E naquele sal√£o simples, entre sorrisos tortos e abra√ßos desajeitados, firmaram um pacto mais silencioso do que o pr√≥prio ‚Äúsim‚Äù.`;
        typeWriter(texto, resposta, 0, 30);
      } else if (escolha === "separar") {
        tituloFase.textContent = "O recome√ßo solit√°rio";
        const texto = `Samuel fechou a porta com cuidado, como se o sil√™ncio pudesse apagar os ru√≠dos que vinham de dentro.

Samara, sentada no sof√°, n√£o chorava mais. Apenas mexia na alian√ßa que agora parecia pesada demais.

‚Äî Talvez o amor n√£o acabe ‚Äî ela disse. ‚Äî Talvez ele s√≥ mude de endere√ßo.

‚Äî E √†s vezes nem deixa bilhete ‚Äî completou ele, antes de sair.

O come√ßo do fim √© quase sempre mais calmo do que imaginamos.`;

        typeWriter(texto, resposta, 0, 30, () => {
          setTimeout(() => {
            window.location.href = "../../index.html";
          }, 5000);
        });
      } else {
        tituloFase.textContent = "Erro";
        typeWriter("Voc√™ ainda n√£o jogou a primeira fase.", resposta, 0, 30);
      }
    }

    function mostrarHistoriaCompleta(escolhaEmprego) {
      tituloFase.textContent = "Eis a√≠ o descendente üë∂üèΩ";
      const textoInicial = `Samara chegou com os olhos cheios d‚Äô√°gua, segurando o pequeno teste nas m√£os tr√™mulas.
        
‚Äî Samuel, estou gr√°vida.

Ele n√£o respondeu de imediato. Apenas a observou por longos segundos, como se ela tivesse acabado de abrir uma janela nova no mundo. Por fim, respirou fundo e assentiu, como quem aceita o improv√°vel com ternura.

Os meses seguintes foram um turbilh√£o calado ‚Äî entre consultas, sonhos sussurrados e receios n√£o ditos. Quando a crian√ßa finalmente chegou, numa madrugada √∫mida de abril, os dois n√£o choraram. Apenas se olharam. E riram.`;

      const nome = nomeBebe || "O beb√™";
      const genero = generoBebe || "masculino";
      const textoNome = `\n\nO beb√™ recebeu o nome de ${nome}, um nome que soava novo, ainda sem hist√≥ria, mas j√° carregado de promessas. Era ${genero === "masculino" ? "um menino" : "uma menina"} com olhos de universo, e os dois sabiam: tudo o que vier depois, ter√° esse pequeno como sol.`;

      let textoEmprego = "";
      if (escolhaEmprego === "samuel_emprego") {
        textoEmprego = `Samuel saiu cedo naquela manh√£. A barba mal feita, a camisa limpa ‚Äî mas amarrotada ‚Äî e a esperan√ßa apertada nos bolsos. Conseguiu emprego num mercado de bairro. Nada grandioso, mas quando voltou e Samara o viu chegar com o primeiro p√£o comprado com o pr√≥prio suor, ela n√£o disse nada. Apenas sorriu.`;
      } else if (escolhaEmprego === "samara_emprego") {
        textoEmprego = `Samara passou na entrevista quase sem acreditar. Quando saiu do pr√©dio, sentiu o vento bagun√ßar os cabelos e a coragem soprar mais forte. Em casa, Samuel cuidava do beb√™ com m√£os desajeitadas, mas firmes. Quando ela entrou e disse "consegui", ele respondeu com um beijo na testa e um suspiro aliviado.`;
      }

      resposta.innerHTML = "";
      continuaTexto.innerHTML = "";
      resposta.innerHTML = textoInicial.replace(/\n/g, "<br>");
      continuaTexto.style.display = "block";
      continuaTexto.innerHTML = textoNome.replace(/\n/g, "<br>") + "<br><br>" + textoEmprego.replace(/\n/g, "<br>");
      inputArea.style.display = "none";
      opcoesHistoria.style.display = "none";
    }

    function mostrarContinuidadeNomeSalvo(nome, genero) {
      inputArea.style.display = "none";
      continuaTexto.innerHTML = "";
      continuaTexto.style.display = "block";
      const textoFinal = `\n\nO beb√™ recebeu o nome de ${nome}, um nome que soava novo, ainda sem hist√≥ria, mas j√° carregado de promessas. Era ${genero === "masculino" ? "um menino" : "uma menina"} com olhos de universo, e os dois sabiam: tudo o que vier depois, ter√° esse pequeno como sol.`;
      typeWriter(textoFinal, continuaTexto, 0, 30, () => {
        mostrarOpcoes();
      });
    }

    function selecionarGenero(genero) {
      generoSelecionado = genero;
      document.getElementById('btnMenino').classList.remove('genero-selecionado');
      document.getElementById('btnMenina').classList.remove('genero-selecionado');
      if (genero === 'masculino') {
        document.getElementById('btnMenino').classList.add('genero-selecionado');
      } else {
        document.getElementById('btnMenina').classList.add('genero-selecionado');
      }
    }

    function confirmarNome() {
      const nome = document.getElementById("nomeBebe").value.trim();
      if (!nome || !generoSelecionado) {
        alert("Por favor, preencha o nome e selecione o g√™nero.");
        return;
      }

      localStorage.setItem('nomeBebe', nome);
      localStorage.setItem('generoBebe', generoSelecionado);
      inputArea.style.display = "none";
      const textoFinal = `\n\nO beb√™ recebeu o nome de ${nome}, um nome que soava novo, ainda sem hist√≥ria, mas j√° carregado de promessas. Era ${generoSelecionado === "masculino" ? "um menino" : "uma menina"} com olhos de universo, e os dois sabiam: tudo o que vier depois, ter√° esse pequeno como sol.`;
      continuaTexto.style.display = "block";
      // Aqui mantemos o texto antigo e agregamos o novo com digita√ß√£o
      typeWriter(textoFinal, continuaTexto, 0, 30, () => {
        mostrarOpcoes();
      });
    }

    function mostrarOpcoes() {
      opcoesHistoria.innerHTML = "";
      opcoesHistoria.className = "choiceContainer";
      opcoesHistoria.style.display = "flex";

      const opcoes = [
        { texto: "Samuel arranja emprego", valor: "samuel_emprego" },
        { texto: "Samara arranja emprego", valor: "samara_emprego" },
        { texto: "Samuel decide vagabundear", valor: "reprovar" }
      ];

      let i = 0;

      function digitarBotao() {
        if (i < opcoes.length) {
          const opcao = opcoes[i];
          const btn = document.createElement("button");
          btn.className = "choiceButton";
          btn.disabled = true;
          opcoesHistoria.appendChild(btn);

          typeWriter(opcao.texto, btn, 0, 30, () => {
            btn.disabled = false;
            btn.onclick = () => {
              if (opcao.valor === "reprovar") {
                alert("Sua escolha foi considerada irrespons√°vel. Voltando ao in√≠cio...");
                setTimeout(() => {
                  localStorage.removeItem('escolhaFinal1');
                  window.location.href = "#";
                }, 2000);
              } else {
                localStorage.setItem("escolhaFinal1", opcao.valor);
                opcoesHistoria.style.display = "none";
                // Ao inv√©s de limpar o texto, vamos agregar o texto da escolha na continua√ß√£o
                let textoEmprego = "";
                if (opcao.valor === "samuel_emprego") {
                  textoEmprego = `Samuel saiu cedo naquela manh√£. A barba mal feita, a camisa limpa ‚Äî mas amarrotada ‚Äî e a esperan√ßa apertada nos bolsos. Conseguiu emprego num mercado de bairro. Nada grandioso, mas quando voltou e Samara o viu chegar com o primeiro p√£o comprado com o pr√≥prio suor, ela n√£o disse nada. Apenas sorriu.`;
                } else if (opcao.valor === "samara_emprego") {
                  textoEmprego = `Samara passou na entrevista quase sem acreditar. Quando saiu do pr√©dio, sentiu o vento bagun√ßar os cabelos e a coragem soprar mais forte. Em casa, Samuel cuidava do beb√™ com m√£os desajeitadas, mas firmes. Quando ela entrou e disse "consegui", ele respondeu com um beijo na testa e um suspiro aliviado.`;
                }
                continuaTexto.innerHTML += "<br><br>";
                typeWriter(textoEmprego, continuaTexto, 0, 30);
              }
            };
            i++;
            setTimeout(digitarBotao, 300);
          });
        }
      }

      digitarBotao();
    }

    window.onload = iniciarDigitacao;
  </script>
  <script src="../../js/contadores.js"></script>
</body>
</html>
