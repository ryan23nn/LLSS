<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fase In√≠cio</title>
  <link rel="stylesheet" href="css/geral.css">
  <link rel="icon" href="img/icon.png" type="image/x-icon">
</head>
<body>
  <nav>
    <p id="filhos-contador">Filhos: 0</p>
    <p id="dinheiro-contador">Dinheiro: R$ 0</p>
  </nav>
  <section class="jogo">
    <img src="img/icon.png" style="width: 9vw;margin: 2%">
    <h1>Love, Life and Samuel and Samara</h1>
    <div id="gameContainer">
      <button id="startButton">Come√ßar Jogo</button>
    </div>
  </section>

  <script>
    const historia = `Samuel sempre foi reservado, perdido em seus pr√≥prios pensamentos enquanto a escola exigia que ele se encaixasse. Ele era estudioso, mas carregava d√∫vidas e uma solid√£o discreta. At√© que, numa manh√£ qualquer, cruzou o olhar com Samara.\n\nEla era burra, mas sua personalidade intensa e cheia de contradi√ß√µes chamava aten√ß√£o. Por tr√°s da postura desafiadora, escondia inseguran√ßas e um desejo de ser vista. Come√ßaram com olhares furtivos, depois vieram os sorrisos t√≠midos. Com o tempo, criaram um v√≠nculo delicado e cheio de significados. Samuel se fascinava pela for√ßa e fragilidade de Samara, enquanto ela via nele um ref√∫gio‚Äîalgu√©m que n√£o julgava, apenas compreendia.\n\nMas os sentimentos trouxeram desafios. Samara, atormentada por sua pr√≥pria inseguran√ßa, afastava-se nos momentos em que mais precisava de apoio. Samuel, por sua vez, tentava se agarrar ao que estavam construindo, lutando contra suas pr√≥prias d√∫vidas.\n\nEntre desencontros e expectativas frustradas, o amor deles era um misto de medo e esperan√ßa. E ent√£o, quando ningu√©m esperava, algo aconteceu...`;

    const gameContainer = document.getElementById('gameContainer');

    window.onload = () => {
      const escolhaFeita = localStorage.getItem('escolhaFinal');
      const textoFinal = localStorage.getItem('textoFinal');

      if (escolhaFeita && textoFinal) {
        exibirHistoriaCompleta(textoFinal);
      } else {
        document.getElementById('startButton').onclick = () => {
          startStory();
        };
      }
    };

    function startStory() {
      gameContainer.innerHTML = `
        <div class="storyText"></div>
        <div class="choiceContainer"></div>
        <div id="extraText"></div>
      `;
      const storyText = document.querySelector(".storyText");
      typeWriter(historia, storyText, 0, 30, showChoices);
    }

    function typeWriter(text, element, i, speed, callback) {
      if (i < text.length) {
        if (text.substring(i, i + 3) === '...') {
          element.innerHTML += '...';
          i += 3;
          setTimeout(() => typeWriter(text, element, i, speed, callback), speed);
        } else {
          element.innerHTML += text.charAt(i);
          const currentChar = text.charAt(i);
          const isPauseChar = currentChar === '.' && !(text.substring(i, i + 3) === '...') && i < text.length - 3;
          const delay = isPauseChar ? 900 : speed;
          setTimeout(() => typeWriter(text, element, i + 1, speed, callback), delay);
        }
      } else {
        if (callback) callback();
      }
    }

    function showChoices() {
      const choiceContainer = document.querySelector(".choiceContainer");
      choiceContainer.innerHTML = `
        <button class="choiceButton" onclick="casar(this)">eles decidem se casar.</button>
        <button class="choiceButton" onclick="separar(this)">eles n√£o aguentam e se separam.</button>
        <button class="choiceButton" onclick="engravidar(this)">samara engravida.</button>
      `;
    }

    function casar(button) {
      const texto = `\n\nüíç\nSamuel e Samara se casaram e est√£o a viver uma hist√≥ria juntos!\n\nPrepare-se para a pr√≥xima fase...`;
      salvarEscolha('casar', texto);
      appendToStory(texto);
      disableChoices();
    }

    function separar(button) {
      const texto = `\n\nüíî\nSamuel e Samara seguiram caminhos diferentes...\n\nGame Over.`;
      salvarEscolha('separar', texto);
      appendToStory(texto, true);
      disableChoices();
    }

    function engravidar(button) {
      const texto = `\n\nü§∞\nSamara descobriu que est√° gr√°vida! Uma nova etapa come√ßa para Samuel e Samara...\n\nPrepare-se para a pr√≥xima fase da hist√≥ria!`;
      salvarEscolha('engravidar', texto);
      appendToStory(texto);
      disableChoices();
      adicionarFilho();
    }

    function salvarEscolha(escolha, texto) {
      localStorage.setItem('escolhaFinal', escolha);
      localStorage.setItem('textoFinal', texto);
    }

    function appendToStory(text, showRestart = false) {
      const extraText = document.getElementById("extraText");
      const newParagraph = document.createElement("div");
      extraText.appendChild(newParagraph);

      typeWriter(text, newParagraph, 0, 30, () => {
        if (showRestart) {
          const choiceContainer = document.querySelector(".choiceContainer");
          const restartBtn = document.createElement("button");
          restartBtn.id = "restartButton";
          restartBtn.textContent = "Reiniciar Jogo";
          restartBtn.onclick = () => {
            localStorage.removeItem('escolhaFinal');
            localStorage.removeItem('textoFinal');
            location.reload();
          };
          restartBtn.style.opacity = "1";
          restartBtn.style.cursor = "pointer";
          choiceContainer.appendChild(restartBtn);
        } else {
          setTimeout(() => {
            const nextBtn = document.createElement("button");
            nextBtn.id = "nextPhaseButton";
            nextBtn.textContent = "‚û° Pr√≥xima Fase";
            nextBtn.onclick = () => window.location.href = "paginas/fases/fase1.html";
            nextBtn.style.opacity = "1";
            nextBtn.style.cursor = "pointer";
            extraText.appendChild(nextBtn);
          }, 3000);
        }
      });
    }

    function disableChoices() {
      const choiceButtons = document.querySelectorAll(".choiceButton");
      choiceButtons.forEach(btn => {
        btn.disabled = true;
        btn.style.opacity = '0.5';
        btn.style.cursor = 'default';
      });
    }

    function exibirHistoriaCompleta(textoFinal) {
      gameContainer.innerHTML = `
        <div class="storyText">${historia.replace(/\n/g, '<br>')}</div>
        <div class="choiceContainer">Voc√™ j√° fez sua escolha.</div>
        <div id="extraText"><div>${textoFinal.replace(/\n/g, '<br>')}</div></div>
      `;

      const escolha = localStorage.getItem('escolhaFinal');
      const choiceContainer = document.querySelector(".choiceContainer");

      if (escolha !== 'separar') {
        const nextBtn = document.createElement("button");
        nextBtn.id = "nextPhaseButton";
        nextBtn.textContent = "‚û° Pr√≥xima Fase";
        nextBtn.onclick = () => window.location.href = "paginas/fases/fase1.html";
        nextBtn.style.opacity = "1";
        nextBtn.style.cursor = "pointer";
        choiceContainer.appendChild(nextBtn);
      } else {
        const restartBtn = document.createElement("button");
        restartBtn.id = "restartButton";
        restartBtn.textContent = "Reiniciar Jogo";
        restartBtn.onclick = () => {
          localStorage.removeItem('escolhaFinal');
          localStorage.removeItem('textoFinal');
          location.reload();
        };
        restartBtn.style.opacity = "1";
        restartBtn.style.cursor = "pointer";
        choiceContainer.appendChild(restartBtn);
      }
    }

    // Fun√ß√£o placeholder para n√£o quebrar c√≥digo
    function adicionarFilho() {
      console.log('Fun√ß√£o adicionarFilho chamada');
    }
  </script>

  <script src="js/contadores.js"></script>
</body>
</html>
